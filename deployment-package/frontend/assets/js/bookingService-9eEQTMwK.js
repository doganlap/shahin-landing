const n="https://grc-backend-prod.delightfulwave-81a84bdf.eastus.azurecontainerapps.io/api",l=async e=>{try{const t=await fetch(`${n}/landing/requests`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({name:e.name,company:e.company,email:e.email,phone:e.phone,date:e.preferredDate,time:e.preferredTime,type:e.requestType,package:e.companySize,features:e.sector,message:e.message||"",lead_score:a(e),timestamp:new Date().toISOString(),source:"landing-page",userAgent:navigator.userAgent,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();return s("booking_submitted",e.requestType,o.bookingId),{success:!0,bookingId:o.bookingId,message:o.message,confirmationEmail:o.confirmationEmail}}catch(t){throw console.error("Booking submission error:",t),s("booking_error",e.requestType,t.message),await i(e),new Error("Failed to submit booking. We have saved your request and will contact you shortly.")}},a=e=>{let t=0;return t+={small:10,medium:25,large:40,enterprise:50}[e.companySize]||0,t+={financial:20,healthcare:15,government:25,technology:15,energy:20,manufacturing:10,other:5}[e.sector]||0,t+=e.requestType==="poc"?20:10,e.message&&e.message.length>20&&(t+=10),e.email&&!e.email.includes("@gmail.com")&&!e.email.includes("@yahoo.com")&&!e.email.includes("@outlook.com")&&(t+=5),Math.min(t,100)},i=async e=>{try{const t=JSON.parse(localStorage.getItem("pending_bookings")||"[]");t.push({...e,storedAt:new Date().toISOString(),retryCount:0}),localStorage.setItem("pending_bookings",JSON.stringify(t))}catch(t){console.error("Failed to store booking locally:",t)}},s=(e,t,o)=>{window.gtag&&window.gtag("event",e,{booking_type:t,value:o,timestamp:new Date().toISOString()}),window.appInsights&&window.appInsights.trackEvent({name:e,properties:{bookingType:t,value:o}}),window.fbq&&window.fbq("track","Lead",{content_name:t,value:o}),window.lintrk&&window.lintrk("track",{conversion_id:"12345678"})},c=async(e,t="demo")=>{try{const o=await fetch(`${n}/landing/availability?date=${e}&type=${t}`,{headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!o.ok)throw new Error("Failed to fetch availability");const r=await o.json();return{availableSlots:r.availableSlots||[],bookedSlots:r.bookedSlots||[],totalSlots:r.totalSlots||8,availableCount:r.availableCount||0}}catch(o){console.error("Availability check error:",o);const r=["09:00 AM","10:00 AM","11:00 AM","12:00 PM","01:00 PM","02:00 PM","03:00 PM","04:00 PM"];return{availableSlots:r,bookedSlots:[],totalSlots:r.length,availableCount:r.length}}};export{a as calculateLeadScore,c as getAvailableTimeSlots,l as submitBooking};
